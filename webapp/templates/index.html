<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Image Classifier</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body { background-color: #f8f9fa; }
        .main-container { max-width: 800px; margin: 0 auto; padding: 20px; }
        .image-preview { width: 100%; max-height: 300px; object-fit: contain; }
        .prediction-box { min-height: 200px; }
    </style>
</head>
<body>
    <div class="main-container">
        <h1 class="text-center mb-4">Image Classifier</h1>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title">Upload Image</h5>
                        <input type="file" class="form-control-file" id="imageUpload" accept="image/*">
                        <img id="imagePreview" class="mt-3 image-preview" src="" alt="Image preview">
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Predictions</h5>
                        <div id="predictions" class="prediction-box">
                            <p class="text-muted">Upload an image to see predictions.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <button id="predictButton" class="btn btn-primary btn-block mt-3">Predict</button>
    </div>

    <div id="loading" class="position-fixed w-100 h-100 d-none" style="background: rgba(255,255,255,0.8); top: 0; left: 0;">
        <div class="d-flex justify-content-center align-items-center h-100">
            <div class="spinner-border text-primary" role="status">
                <span class="sr-only">Loading...</span>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        $(document).ready(function() {
            let base64Image = "";

            $('#imageUpload').change(function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        $('#imagePreview').attr('src', event.target.result);
                        base64Image = event.target.result.split(',')[1];
                    }
                    reader.readAsDataURL(file);
                }
            });

            $('#predictButton').click(function() {
                if (base64Image) {
                    $('#loading').removeClass('d-none');
                    $.ajax({
                        url: '../predict',
                        type: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify({image: base64Image}),
                        success: function(response) {
                            $('#predictions').html('<pre>' + JSON.stringify(response, null, 2) + '</pre>');
                            $('#loading').addClass('d-none');
                        },
                        error: function() {
                            $('#predictions').html('<p class="text-danger">Error occurred during prediction.</p>');
                            $('#loading').addClass('d-none');
                        }
                    });
                } else {
                    alert('Please upload an image first.');
                }
            });
        });
    </script>
</body>
</html>